### Bibliotecas não utilizadas
###library("stringi", lib.loc="~/R/win-library/3.4")
###library("stringr", lib.loc="~/R/win-library/3.4")

# 0.1 - Descompacta e acessa pasta do arquivo
wd<- paste((getwd()),"/R",sep="")
setwd(wd)
unzip("curto.zip",exdir = "./curto",junkpaths = TRUE)
wd<- paste((getwd()),"/curto",sep="")
setwd(wd)

# 0.2 - Lista dos arquivos descompactados na pasta
 doclist<- list.files(path = ".", pattern = ".txt", all.files = FALSE, full.names = FALSE, recursive = FALSE, ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

# 0.3 -Função para leitura do arquivo 
# Obs: troca os caracteres maiúsculos por minúsculos, descarta termos com 1 caracter.
obtem_vetor <- function(f,lower=FALSE,min_len=2) {
  vetor <- scan(f, sep="", what=character(),quote="")

  if(lower) {
    vetor <- tolower(vetor)
  }
  return(vetor[nchar(vetor)>=min_len])
}

# 0.4 -Loop para Calculo de TF (Sem penalizar) e gera arquivo csv

for (i in 1:(length(doclist))){
	arquivo <- doclist[i]
	termos <- obtem_vetor(arquivo)
	xyz<-unlist(strsplit(termos,"\\W+"))
	palavras <- paste (i,names(table(xyz)),table(xyz),sep=",")
	vetor <- paste (palavras,sep="\n","\n")
	write.csv(cat(vetor,file="curto.csv",append=TRUE))

}

# 0.5 - Leitura do arquivo csv com o resultado da matriz Term frequency (TF) (sem penalizar)
#termosdocumentos = read.csv("curto.csv",stringAsFactors = F)
termosdocumentos = read.csv("curto.csv")
colnames(termosdocumentos)=c("doc","termo","freq")

# 1.0 - Solicitado "código para produzir a matriz de document frequency (DF) conforme a fórmula com log"
# Obs.: Acho que se deseja iDF x Termo, não?
# Obs.2: Tem algo estranho nesse termosdocumentos

s<-summary (as.factor(termosdocumentos$termo),maxsum=999999)
termo_df_idf <- as.data.frame(cbind(Termos = names(s),df = s, idf=log10((length(doclist))/s)), stringsAsFactors=F, row.names = 1:length(s))
item1 <- termo_df_idf

# 2.0 Gera um arquivo pdf com o resultado da matriz DF x Termo
# Obs.: Acho que se deseja iDF x Termo, não?

# WIP

# 3.0 - Código para produzir a matriz de Term frequency (TF) conforme a fórmula com log
# Obs.: #Calcula o terceiro item solicitado no trabalho -> Matriz de Term Frequency (TF) (penalizando)

logdf <- as.data.frame(cbind(termosdocumentos$doc,termosdocumentos$termo,(1+log10(termosdocumentos$freq))))
colnames(logdf)<- c("Doc_number", "Termo", "TF")


# 4.0 insira no arquivo pdf com o resultado da matriz TF x Documento.
# WIP

# 5.0 Código para produzir a matriz de TF*IDF
# WIP -> talvez algo como abaixo
for (i in 1:(length(doclist))){

	coluna<-paste("i6.Doc",i,sep="")
	valor<-paste( "(as.numeric(as.character(x$Doc",i,", row.names = NULL)))*(as.numeric(as.character(termo_df_idf$idf,row.names = NULL)))" ,sep="")
	assign(coluna,eval(parse(text=valor)))
	valor2<-paste("as.data.frame(i6.Doc",i,")",sep="")
	assign(coluna,eval(parse(text=valor2)))
	t1 <- paste( "colnames(",coluna,")<-c('Doc",i,"')", sep="" )
	eval(parse(text=t1))
	t2<-paste( "cbind(i6,i6.Doc", i, ", row.names=NULL)", sep="" )
	i6<-eval(parse(text=t2))
	t3 <- paste( "rm(", coluna,")",sep="" )
	eval(parse(text=t3))
}

